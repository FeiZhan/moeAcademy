/*! moeproject 2014-06-07 */
MOEPROJ.MOEBATTLE=MOEPROJ.MOEBATTLE||new Object;var MOEBATTLE=MOEPROJ.MOEBATTLE;MOEBATTLE.ui,MOEBATTLE.data=["data/cards.json"],MOEBATTLE.load=function(a){MOEBATTLE.ui=MOEPROJ.MOEBATTLEUI,MOEBATTLE.ui.init(a),MOEPROJ.load({canvas:a,html:MOEBATTLE.ui.html,data:MOEBATTLE.data},MOEBATTLE.run,MOEBATTLE.loadData)},MOEBATTLE.loadData=function(a){MOEBATTLE.cards=MOEBATTLE.cards.concat(a)},MOEBATTLE.run=function(){MOEBATTLE.ui.load(),MOEBATTLE.actions.push({type:"gameStart"}),setInterval(function(){MOEBATTLE.nextAction()},100)},MOEBATTLE.game={orders:[0,1],deck:new Array,discard:new Array,round_count:0,shuffle_count:0,current:-1},MOEBATTLE.cards=new Array,MOEBATTLE.players=[{name:"me",order:0,maxhp:20,hp:20,maxmp:0,mp:0,hands:[],area:[],status:[],equip:[]},{name:"opponent",order:1,maxhp:20,hp:20,maxmp:0,mp:0,hands:[],area:[],status:[],equip:[]}],MOEBATTLE.actions=new Array,MOEBATTLE.nextAction=function(){if(!(0==MOEBATTLE.actions.length||MOEBATTLE.ui.AnimaCount>0)){var a=MOEBATTLE.actions.shift();void 0!==a.type&&(console.debug(a.type),"function"==typeof MOEBATTLE[a.type]&&MOEBATTLE[a.type](a))}},MOEBATTLE.gameStart=function(){for(var a in MOEBATTLE.players)MOEBATTLE.ui.playerPrepare(a);MOEBATTLE.game.discard=new Array,MOEBATTLE.game.deck=new Array;for(var a in MOEBATTLE.cards)MOEBATTLE.game.deck.push(a);MOEBATTLE.shuffle(MOEBATTLE.game.deck);var b=new Array;b.push({type:"playersShuffle"});for(var a in MOEBATTLE.game.orders)b.push({type:"cardsDraw",number:1,target:MOEBATTLE.game.orders[a]});MOEBATTLE.actions=b.concat(MOEBATTLE.actions),MOEBATTLE.actions.push({type:"playerStart"})},MOEBATTLE.gameOver=function(){MOEBATTLE.ui.gameOver()},MOEBATTLE.gamePause=function(){},MOEBATTLE.gamePause=function(){},MOEBATTLE.gameWin=function(){},MOEBATTLE.gameLose=function(){},MOEBATTLE.gameDraw=function(){},MOEBATTLE.deckShuffle=function(){MOEBATTLE.shuffle(MOEBATTLE.game.deck),++MOEBATTLE.game.shuffle_count},MOEBATTLE.shuffle=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);},MOEBATTLE.deckPrepare=function(){MOEBATTLE.game.deck=MOEBATTLE.game.deck.concat(MOEBATTLE.game.discard),MOEBATTLE.game.discard=new Array,MOEBATTLE.actions.unshift({type:"deckShuffle"})},MOEBATTLE.playersShuffle=function(){MOEBATTLE.game.orders=new Array;for(var a in MOEBATTLE.players)MOEBATTLE.game.orders.push(a);MOEBATTLE.shuffle(MOEBATTLE.game.orders);for(var a in MOEBATTLE.players)MOEBATTLE.players[a].order=MOEBATTLE.game.orders[a]},MOEBATTLE.playerStart=function(){++MOEBATTLE.game.current,MOEBATTLE.game.current>=MOEBATTLE.players.length&&(MOEBATTLE.game.current%=MOEBATTLE.players.length,++MOEBATTLE.game.round_count),MOEBATTLE.ui.playerStart(),MOEBATTLE.players[MOEBATTLE.game.current].maxmp<10&&(MOEBATTLE.actions.unshift({type:"playerGainMP",target:MOEBATTLE.game.current,number:1}),MOEBATTLE.actions.unshift({type:"playerChangeMaxMP",target:MOEBATTLE.game.current,number:MOEBATTLE.players[MOEBATTLE.game.current].maxmp+1})),MOEBATTLE.actions.push({type:"cardsDraw",number:1,target:MOEBATTLE.game.current})},MOEBATTLE.playerEnd=function(){MOEBATTLE.ui.playerEnd(),MOEBATTLE.actions.push({type:"playerStart"})},MOEBATTLE.playerChange=function(){},MOEBATTLE.playerDie=function(){},MOEBATTLE.playerRevive=function(){},MOEBATTLE.playerLoseHP=function(a){MOEBATTLE.players[a.target].hp-=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.playerGainHP=function(a){MOEBATTLE.players[a.target].hp+=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.playerChangeMaxHP=function(a){MOEBATTLE.players[a.target].maxhp=a.number,MOEBATTLE.ui.playerChangeMaxHP(a.target,a.number)},MOEBATTLE.playerLoseMP=function(a){MOEBATTLE.players[a.target].mp-=a.number,MOEBATTLE.ui.playerChangeMP(a.target,MOEBATTLE.players[a.target].mp)},MOEBATTLE.playerGainMP=function(a){MOEBATTLE.players[a.target].mp+=a.number,MOEBATTLE.ui.playerChangeMP(a.target,MOEBATTLE.players[a.target].mp)},MOEBATTLE.playerChangeMaxMP=function(a){MOEBATTLE.players[a.target].maxmp=a.number,MOEBATTLE.ui.playerChangeMaxMP(a.target,a.number)},MOEBATTLE.playerLoseStatus=function(a){MOEBATTLE.players[a.target].status.splice(MOEBATTLE.players[a.target].status.indexOf(a.status),1),MOEBATTLE.ui.playerLoseStatus(a.target,a.status)},MOEBATTLE.playerGainStatus=function(a){MOEBATTLE.players[a.target].status.indexOf(a.status)>=0,MOEBATTLE.players[a.target].status.push(a.status),MOEBATTLE.ui.playerGainStatus(a.target,a.status)},MOEBATTLE.playerGainEquip=function(){},MOEBATTLE.cardsDraw=function(a){if(!(a.number<=0||a.target<0||a.target>=MOEBATTLE.players.length)){if(a.number>MOEBATTLE.game.deck.length&&MOEBATTLE.deckPrepare(),a.number>MOEBATTLE.game.deck.length)return void MOEBATTLE.actions.unshift({type:"gameOver"});for(var b=0;b<a.number;++b)MOEBATTLE.actions.unshift({type:"cardDraw",target:a.target,from:a.from})}},MOEBATTLE.cardDraw=function(a){var b=MOEBATTLE.game.deck.pop();MOEBATTLE.players[a.target].hands.push(b),MOEBATTLE.ui.cardDraw(a.target,b,a.from)},MOEBATTLE.cardDiscard=function(){},MOEBATTLE.cardUse=function(a){switch(MOEBATTLE.players[a.from].hands.splice(MOEBATTLE.players[a.from].hands.indexOf(a.card),1),MOEBATTLE.cards[a.card].type){case"character":MOEBATTLE.actions.unshift({type:"cardAddToArea",card:a.card,from:a.from});break;case"effect":default:MOEBATTLE.actions.unshift({type:"cardUseWithoutTarget",from:a.from,card:a.card})}},MOEBATTLE.cardAddToArea=function(a){MOEBATTLE.players[a.from].area.push(a.card),MOEBATTLE.ui.cardAddToArea(a.card,a.from)},MOEBATTLE.cardUseWithoutTarget=function(a){if("skill"in MOEBATTLE.cards[a.card]){var b=MOEPROJ.getFunctionFromString(MOEBATTLE.cards[a.card].skill);"function"==typeof b&&b(a)}MOEBATTLE.game.discard.push(a.card),MOEBATTLE.ui.cardUseWithoutTarget(a.card)},MOEBATTLE.cardUseWithTarget=function(a){if("skill"in MOEBATTLE.cards[a.card]){var b=MOEPROJ.getFunctionFromString(MOEBATTLE.cards[a.card].skill);"function"==typeof b&&b(a)}MOEBATTLE.game.discard.push(a.card),MOEBATTLE.ui.cardUseWithoutTarget(a.card)},MOEBATTLE.charLoseHP=function(a){MOEBATTLE.players[a.target].hp-=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.charGainHP=function(a){MOEBATTLE.players[a.target].hp+=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.charLoseStatus=function(a){MOEBATTLE.players[a.target].status.splice(MOEBATTLE.players[a.target].status.indexOf(a.status),1),MOEBATTLE.ui.playerLoseStatus(a.target,a.status)},MOEBATTLE.charGainStatus=function(a){MOEBATTLE.players[a.target].status.indexOf(a.status)>=0,MOEBATTLE.players[a.target].status.push(a.status),MOEBATTLE.ui.playerGainStatus(a.target,a.status)},MOEPROJ.MOEBATTLE=MOEPROJ.MOEBATTLE||new Object,MOEPROJ.MOEBATTLE.SKILLS=MOEPROJ.MOEBATTLE.SKILLS||new Object;var SKILLS=MOEPROJ.MOEBATTLE.SKILLS;SKILLS.loseHP=function(a){MOEBATTLE.actions.unshift({type:"playerLoseHP",target:a.from?0:1,number:1})},SKILLS.charLoseHP=function(a){MOEBATTLE.actions.unshift({type:"charLoseHP",target:a.target,number:1,card:a.card})},SKILLS.drawCard=function(a){MOEBATTLE.actions.unshift({type:"cardsDraw",target:a.from,number:2})},SKILLS.gainPositiveStatus=function(a){MOEBATTLE.actions.unshift({type:"playerGainStatus",target:a.from,status:"joy"})},MOEPROJ.MOEBATTLEUI=MOEPROJ.MOEBATTLEUI||new Object;var MOEBATTLEUI=MOEPROJ.MOEBATTLEUI;MOEBATTLEUI.html=' <div id="board"></div> <div id="myhand" class="hand"></div> <div id="yourhand" class="hand"></div> <a href="#" id="endbutton" class="button disable">结束</a> <div id="myhead" class="head"> 	<img src="#" alt="photo" class="" /> 	<div class="hp"> 		<span>0</span> / <span>0</span> 	</div> 	<div class="mp"> 		<span>0</span> / <span>0</span> 	</div> </div> <div id="yourhead" class="head"> 	<img src="#" alt="photo" class="" /> 	<div class="hp"> 		<span>0</span> / <span>0</span> 	</div> 	<div class="mp"> 		<span>0</span> / <span>0</span> 	</div> </div> <div id="mystatusarea" class="statusarea"></div> <div id="yourstatusarea" class="statusarea"></div> <div id="myarea" class="area"></div> <div id="yourarea" class="area"></div> <div id="arrow"> 	<canvas /> </div> <div id="anime"> 	<img src="#" alt="anime" class="" /> </div> <div id="detail"> 	<div class="name"></div> 	<div class="cost"></div> 	<div class="def"></div> 	<div class="atk"></div> 	<div class="card-hp"></div> 	<img src="#" alt="photo" class="" /> 	<div class="card-detail"></div> </div> ',MOEBATTLEUI.init=function(a){document.title="萌娘对战",$("#"+a).addClass("moebattle")},MOEBATTLEUI.load=function(){$("#"+MOEPROJ.config.canvas+" #endbutton").on("click",function(){$(this).hasClass("disable")||MOEBATTLE.actions.push({type:"playerEnd"})}),$("#"+MOEPROJ.config.canvas+" #board").droppable({drop:function(a,b){var c=b.draggable[0].id;void 0!==c&&(c=c.substring(5),c in MOEBATTLE.cards&&MOEBATTLEUI.cardDrop(c))},out:function(a,b){var c=b.draggable[0].id;void 0!==c&&(c=c.substring(5),c in MOEBATTLE.cards)}});var a=$("#"+MOEPROJ.config.canvas+" #arrow canvas")[0].getContext("2d");a.fillStyle="yellow",a.beginPath(),a.moveTo(150,0),a.lineTo(0,45),a.lineTo(100,45),a.lineTo(100,150),a.lineTo(200,150),a.lineTo(200,45),a.lineTo(300,45),a.closePath(),a.fill()},MOEBATTLEUI.AnimaCount=0,MOEBATTLEUI.detail_lock=!1,MOEBATTLEUI.showDetail=function(a,b){if(!MOEBATTLEUI.detail_lock){MOEBATTLEUI.detail_lock=!0,$("#"+MOEPROJ.config.canvas+" #detail .name").html(MOEBATTLE.cards[a].name),$("#"+MOEPROJ.config.canvas+" #detail .cost").html("cost: "+(MOEBATTLE.cards[a].cost||0)),$("#"+MOEPROJ.config.canvas+" #detail .atk").html("moe point: "+(MOEBATTLE.cards[a].atk||0)),$("#"+MOEPROJ.config.canvas+" #detail .card-hp").html("hp: "+(MOEBATTLE.cards[a].hp||0)),$("#"+MOEPROJ.config.canvas+" #detail img").attr("src",MOEBATTLE.cards[a].photo||""),$("#"+MOEPROJ.config.canvas+" #detail .card-detail").html(MOEBATTLE.cards[a].detail||"detaildetaildetaildetaildetaildetaildet aildetaildetaildetaildetaildetaildetaildetaildetaild etaildetaildetaildetaildetaildetaildetaildetaildeta ildetaildetail");var c=$("#"+MOEPROJ.config.canvas+" #detail");c.show().css("visibility","inherit");var d=$("#"+MOEPROJ.config.canvas+" #card-"+a);if(0==d.length&&(d=$("#"+MOEPROJ.config.canvas+" #icon-"+a)),0==d.length)return $("#"+MOEPROJ.config.canvas+" #detail");if(++MOEBATTLEUI.AnimaCount,void 0===b||"auto"==b){var e=d.offset();b=e.top<200?"down":e.top+200>$(window).height()?"up":e.left<$(window).width()/2?"right":"left"}switch(b){case"up":c.css({top:d.offset().top,left:d.offset().left-90,height:"0%",width:d.width()}).animate({top:"-=400px",left:"-=120px",height:"+=400px",width:"+=240px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"down":c.css({top:d.offset().top+d.height(),left:d.offset().left-90,height:"0%",width:d.width()}).animate({left:"-=120px",height:"+=400px",width:"+=240px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"left":c.css({top:d.offset().top,left:d.offset().left-90,height:d.height(),width:"0%"}).animate({top:"-=200px",left:"-=360px",height:"+=400px",width:"+=360px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"right":c.css({top:d.offset().top,left:d.offset().left-90+d.width(),height:d.height(),width:"0%"}).animate({top:"-=200px",height:"+=400px",width:"+=360px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"none":case 0:default:--MOEBATTLEUI.AnimaCount}return $("#"+MOEPROJ.config.canvas+" #detail")}},MOEBATTLEUI.arrow={status:"idle"},MOEBATTLEUI.arrowFollow=function(a,b){if("follow"!=MOEBATTLEUI.arrow.status){var c=$("#"+MOEPROJ.config.canvas+" #card-"+a);if(0==c.length&&(c=$("#"+MOEPROJ.config.canvas+" #icon-"+a)),0!=c.length){++MOEBATTLEUI.AnimaCount,MOEBATTLEUI.arrow.status="follow";for(var d=c.position().top+c.height()/2,e=c.position().left+c.width()/2,f=c.parent();void 0!==f&&f.attr("id")!=MOEPROJ.config.canvas;)e+=f.position().left,d+=f.position().top,f=f.parent();var g=function(a){var b=a.pageX-$("#"+MOEPROJ.config.canvas).offset().left,c=a.pageY-$("#"+MOEPROJ.config.canvas).offset().top,f=Math.sqrt((b-e)*(b-e)+(c-d)*(c-d)),g=(b+e)/2-25,h=(c+d)/2-f/2;$("#"+MOEPROJ.config.canvas+" #arrow").height(f);var i=180*Math.atan2(c-d,b-e)/Math.PI+90;$("#"+MOEPROJ.config.canvas+" #arrow").css({top:h,left:g}).css({WebkitTransform:"rotate("+i+"deg)"}).css({"-moz-transform":"rotate("+i+"deg)"}).css({visibility:"inherit"}).show()},h=function(){a!=MOEBATTLEUI.selectedIcon&&(void 0===MOEBATTLEUI.selectedIcon,$("html").off("mousemove",g).off("click",h),$("#"+MOEPROJ.config.canvas+" #arrow").hide(),MOEBATTLEUI.arrow.status="idle","function"==typeof b&&b(a,MOEBATTLEUI.selectedIcon),--MOEBATTLEUI.AnimaCount)};$("html").on("mousemove",g).on("click",h)}}},MOEBATTLEUI.gameOver=function(){console.log("game over")},MOEBATTLEUI.playerPrepare=function(a){if(++MOEBATTLEUI.AnimaCount,0==a){var b=$("#"+MOEPROJ.config.canvas+" #myhead .hp span");$(b[0]).html(MOEBATTLE.players[a].hp),$(b[1]).html(MOEBATTLE.players[a].maxhp),b=$("#"+MOEPROJ.config.canvas+" #myhead .mp span"),$(b[0]).html(MOEBATTLE.players[a].mp),$(b[1]).html(MOEBATTLE.players[a].maxmp)}else if(1==a){var b=$("#"+MOEPROJ.config.canvas+" #yourhead .hp span");$(b[0]).html(MOEBATTLE.players[a].hp),$(b[1]).html(MOEBATTLE.players[a].maxhp),b=$("#"+MOEPROJ.config.canvas+" #yourhead .mp span"),$(b[0]).html(MOEBATTLE.players[a].mp),$(b[1]).html(MOEBATTLE.players[a].maxmp)}--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.playerStart=function(){++MOEBATTLEUI.AnimaCount,$("#battle .hand.turn").removeClass("turn"),0==MOEBATTLE.game.current?$("#battle #myhand").addClass("turn"):$("#battle #yourhand").addClass("turn"),0==MOEBATTLE.game.current?$("#"+MOEPROJ.config.canvas+" #endbutton").removeClass("disable"):setTimeout(function(){MOEBATTLE.actions.push({type:"playerEnd"})},1e3),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.playerEnd=function(){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #endbutton").addClass("disable"),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.playerChangeHP=function(a,b){0==a?$("#"+MOEPROJ.config.canvas+" #myhead .hp span").html(b):$("#"+MOEPROJ.config.canvas+" #yourhead .hp span").html(b)},MOEBATTLEUI.playerChangeMaxHP=function(a,b){0==a?$($("#"+MOEPROJ.config.canvas+" #myhead .hp span")[1]).html(b):$($("#"+MOEPROJ.config.canvas+" #yourhead .hp span")[1]).html(b)},MOEBATTLEUI.playerChangeMP=function(a,b){0==a?$("#"+MOEPROJ.config.canvas+" #myhead .mp span").html(b):$("#"+MOEPROJ.config.canvas+" #yourhead .mp span").html(b)},MOEBATTLEUI.playerChangeMaxMP=function(a,b){0==a?$($("#"+MOEPROJ.config.canvas+" #myhead .mp span")[1]).html(b):$($("#"+MOEPROJ.config.canvas+" #yourhead .mp span")[1]).html(b)},MOEBATTLEUI.playerLoseStatus=function(a,b){0==a?$("#"+MOEPROJ.config.canvas+" #mystatusarea #status-"+b).remove():$("#"+MOEPROJ.config.canvas+" #yourstatusarea #status-"+b).remove()},MOEBATTLEUI.playerGainStatus=function(a,b){0==a?$("#"+MOEPROJ.config.canvas+" #mystatusarea").append('<div id="status-'+b+'" class="status" />'):$("#"+MOEPROJ.config.canvas+" #yourstatusarea").append('<div id="status-'+b+'" class="status" />')},MOEBATTLEUI.createCard=function(a){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas).append(' 		<div id="card-'+a+'" class=" card"> 			<span>test</span> 			<img src="" alt="photo" /> 			<div class="card-detail"></div> 			<div class="cost param"></div> 			<div class="def param"></div> 			<div class="atk param"></div> 			<div class="card-hp param"></div> 		</div> 	');var b=$("#"+MOEPROJ.config.canvas+" #card-"+a);return b.draggable({stop:function(){$(this).hasClass("inhand")&&$(this).css({top:"0px",left:"0px"})}}),$("#"+MOEPROJ.config.canvas+" #card-"+a+" span").html(MOEBATTLE.cards[a].name),$("#"+MOEPROJ.config.canvas+" #card-"+a+" img").attr("src",MOEBATTLE.cards[a].photo).error(function(){$(this).attr("src","resources/nophoto.jpg")}),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.card-detail").html(MOEBATTLE.cards[a].detail),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.cost").html(MOEBATTLE.cards[a].cost||0),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.def").html(MOEBATTLE.cards[a].def||0),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.atk").html(MOEBATTLE.cards[a].atk||0),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.card-hp").html(MOEBATTLE.cards[a].hp||0),b.hover(function(){$(this).css("z-index",1);var b=MOEBATTLEUI.showDetail(a);return void 0===b?void console.warn("fail to drawCardAnima"):void 0},function(){$(this).css("z-index",0),$("#"+MOEPROJ.config.canvas+" #detail").animate({top:"+=400px",height:"0px"},"fast",function(){$(this).hide(),MOEBATTLEUI.detail_lock=!1})}),--MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #card-"+a)},MOEBATTLEUI.cardDrop=function(a){++MOEBATTLEUI.AnimaCount;var b=$("#"+MOEPROJ.config.canvas+" #card-"+a);if(0!=MOEBATTLE.game.current)return void b.animate({top:"70%",left:"45%"},"slow",function(){--MOEBATTLEUI.AnimaCount});var c=0;b.hasClass("myhand")?c=0:b.hasClass("yourhand")&&(c=1);var d=b.position().top+b.parent().position().top,e=b.position().left+b.parent().position().left;$("#"+MOEPROJ.config.canvas).append(b.detach()),b.removeClass("inhand myhand yourhand"),b.css({top:d,left:e}),void 0!==MOEBATTLE.cards[a].target?MOEBATTLEUI.arrowFollow(a,function(){return void 0===MOEBATTLEUI.selectedIcon?(0==c?($("#"+MOEPROJ.config.canvas+" #myhand").append(b.detach()),b.addClass("inhand myhand")):($("#"+MOEPROJ.config.canvas+" #yourhand").append(b.detach()),b.addClass("inhand yourhand")),void b.css({top:"0px",left:"0px"})):void MOEBATTLE.actions.unshift({type:"cardUseWithTarget",card:a,target:MOEBATTLEUI.selectedIcon})}):MOEBATTLE.actions.unshift({type:"cardUse",from:c,card:a}),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.cardDraw=function(a,b){if(!(0>a||a>=MOEBATTLE.players.length)){var c=MOEBATTLEUI.showDetail(b);if(void 0===c)return void console.warn("fail to cardDraw ui");++MOEBATTLEUI.AnimaCount,c.css({top:"48%",left:"95%",height:"4%",width:"1%"}).animate({top:"10%",left:"50%",height:"80%",width:"40%"},"fast",function(){var c=this;setTimeout(function(){var d="75%",e="45%";0==a?(d="75%",e="45%"):(d="5%",e="45%"),$(c).find(".card-detail").hide(),$(c).animate({top:d,left:e,height:"150px",width:"100px"},"slow",function(){var d=MOEBATTLEUI.createCard(b);0==a?($("#"+MOEPROJ.config.canvas+" #myhand").append(d.detach()),d.addClass("inhand myhand")):($("#"+MOEPROJ.config.canvas+" #yourhand").append(d.detach()),d.addClass("inhand yourhand")),d.css({top:"0px",left:"0px"}),$(c).fadeOut("slow",function(){$(this).find(".card-detail").css({visibility:"inherit"}).show(),MOEBATTLEUI.detail_lock=!1}),d.hide().css({visibility:"inherit"}).fadeIn("slow",function(){--MOEBATTLEUI.AnimaCount})})},200)})}},MOEBATTLEUI.cardUseWithoutTarget=function(a){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #card-"+a).animate({top:"-=100px",left:"-=100px",height:"+=200px",width:"+=200px",opacity:0},"slow",function(){$(this).remove(),MOEBATTLEUI.skillAnimate(a,""),--MOEBATTLEUI.AnimaCount})},MOEBATTLEUI.cardAddToArea=function(a,b){++MOEBATTLEUI.AnimaCount;var c=$("#"+MOEPROJ.config.canvas+" #card-"+a+" img").height(),d=$("#"+MOEPROJ.config.canvas+" #card-"+a+" img").width();c>60&&(d*=60/c,c=60),d>60&&(c*=60/d,d=60),10>c&&(c=10),10>d&&(d=10),MOEBATTLEUI.moveToAreaAnima(a,b,c,d),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.moveToAreaAnima=function(a,b,c,d){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #card-"+a).animate({top:"50%",left:"45%",height:c+"px",width:d+"px"},"slow",function(){$(this).remove(),MOEBATTLEUI.createIcon(b,a,c,d),MOEBATTLEUI.skillAnimate(a,"skill0"),--MOEBATTLEUI.AnimaCount})},MOEBATTLEUI.selectedIcon=void 0,MOEBATTLEUI.createIcon=function(a,b,c,d){++MOEBATTLEUI.AnimaCount;var e;switch(a){case 1:e=$("#"+MOEPROJ.config.canvas+" #yourarea");break;case 0:default:e=$("#"+MOEPROJ.config.canvas+" #myarea")}e.append(' 		<div id="icon-'+b+'" class="icon myuse" style="height: '+c+"px; width: "+d+'px;"> 			<span></span> 			<img src="" alt="icon" class="" /> 			<div class="cost"></div> 			<div class="def"></div> 			<div class="atk"></div> 			<div class="card-hp"></div> 		</div> 	'),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" img").attr("src",MOEBATTLE.cards[b].photo).error(function(){$(this).attr("src","resources/nophoto.jpg")}),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.atk").html(MOEBATTLE.cards[b].atk||0),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.def").html(MOEBATTLE.cards[b].def||0),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.card-hp").html(MOEBATTLE.cards[b].hp||0),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.cost").html(MOEBATTLE.cards[b].cost||0);var f=$("#"+MOEPROJ.config.canvas+" #icon-"+b);return f.hover(function(){MOEBATTLEUI.selectedIcon=b,$(this).css("z-index",1);var a=MOEBATTLEUI.showDetail(b);return void 0===a?void console.warn("fail to drawCardAnima"):void 0},function(){MOEBATTLEUI.selectedIcon=void 0,$(this).css("z-index",0),$("#"+MOEPROJ.config.canvas+" #detail").animate({width:"0px"},"fast",function(){$(this).hide(),MOEBATTLEUI.detail_lock=!1})}),f.on("click",function(){void 0!==MOEBATTLEUI.selectedIcon&&MOEBATTLEUI.arrowFollow(b,function(a,b){if(void 0!==a&&void 0!==b){var c=$("#"+MOEPROJ.config.canvas+" #icon-"+a),d=$("#"+MOEPROJ.config.canvas+" #icon-"+b);if(0!=c.length&&0!=d.length){var e=c.position(),f=c.parent().offset(),g=d.position(),h=d.parent().offset();c.animate({top:g.top+h.top-f.top,left:g.left+h.left-f.left},"fast",function(){c.animate({top:e.top,left:e.left},"fast",function(){})})}}})}),$("#"+MOEPROJ.config.canvas+" #icon-"+b).hide().css({visibility:"inherit"}).fadeIn("fast",function(){--MOEBATTLEUI.AnimaCount}),$("#"+MOEPROJ.config.canvas+" #icon-"+b)},MOEBATTLEUI.skillAnimate=function(a,b){if(a in MOEBATTLE.cards&&void 0!==MOEBATTLE.cards[a].anime&&void 0!==MOEBATTLE.cards[a].anime[b]){++MOEBATTLEUI.AnimaCount;var c=MOEBATTLE.cards[a].anime[b],d=Math.floor(Math.random()*c.length);$("#"+MOEPROJ.config.canvas+" #anime img").attr("src",c[d]),$("#"+MOEPROJ.config.canvas+" #anime").addClass("active").fadeIn("fast").show(),setTimeout(function(){$("#"+MOEPROJ.config.canvas+" #anime").fadeOut("slow",function(){$(this).removeClass("active"),$("#"+MOEPROJ.config.canvas+" #anime img").attr("src",""),--MOEBATTLEUI.AnimaCount})},30)}};var MOEPROJECT=MOEPROJECT||new Object;MOEPROJECT.config={files:["data/moegirls.json"],canvas:void 0,show_detail:!1},MOEPROJECT.init=function(){function a(a,b){$.getJSON(a,function(c){console.log("loaded",a),"function"==typeof b&&b(c)}).fail(function(a,b,c){console.error("data load error",b,c)}).always(function(){})}for(var b in MOEPROJECT.config.files)a(MOEPROJECT.config.files[b],function(a){MOEPROJECT.moegirls=MOEPROJECT.moegirls.concat(a)})},$(function(){MOEPROJECT.init()}),MOEPROJECT.run=function(a){return void 0===a||0==$("#"+a).length?void console.error("undefined canvas",a):(MOEPROJECT.config.canvas=a,$("#"+a).addClass("moecascade"),MOEPROJECT.showFrame(),void MOEPROJECT.waitLoad())},MOEPROJECT.waitLoad=function(){if(0==MOEPROJECT.moegirls.length)return console.log("loading"),void setTimeout(MOEPROJECT.waitLoad,300);for(var a=0;30>a;++a)MOEPROJECT.addMoegirl()},MOEPROJECT.showFrame=function(){MOEPROJECT.order=new Array;var a='<div id="wrapper"><div id="columns"></div></div><div id="detail"><a href="#" class="" target="_blank"><img border="0" src="resources/nophoto.jpg" alt="photo" width="100%" class="" /></a><a href="#" class="" target="_blank"><span></span></a><table class="" border="0"></table></div>';$("#"+MOEPROJECT.config.canvas).empty().append(a),$("#"+MOEPROJECT.config.canvas+" #detail img").error(function(){$(this).attr("src","resources/nophoto.jpg")}),$("#"+MOEPROJECT.config.canvas+" #detail").click(function(a){a.stopPropagation()});var b=function(a){switch(MOEPROJECT.config.show_detail){case!0:"detail"!=a.target.id&&($("#"+MOEPROJECT.config.canvas+" #detail").fadeOut("slow"),$("#"+MOEPROJECT.config.canvas+" #columns .pin").removeClass("opaque"),MOEPROJECT.config.show_detail=!1);break;case!1:break;case"showing":MOEPROJECT.config.show_detail=!0}};$("html").off("click").on("click",b);var c=function(){clearTimeout($.data(this,"scrollTimer")),$.data(this,"scrollTimer",setTimeout(function(){if($(window).scrollTop()==$(document).height()-$(window).height())for(var a=0;20>a;++a)MOEPROJECT.addMoegirl()},250))};$(window).off("scroll").on("scroll",c),$("#"+MOEPROJECT.config.canvas).hide().css({visibility:"inherit"}).fadeIn("slow")},MOEPROJECT.moegirls=new Array,MOEPROJECT.order=new Array,MOEPROJECT.addMoegirl=function(){var a=Math.floor(Math.random()*MOEPROJECT.moegirls.length),b='<div class="pin"><img src="'+MOEPROJECT.moegirls[a].photo+'" /><p>'+MOEPROJECT.moegirls[a].name+"</p></div>";$("#"+MOEPROJECT.config.canvas+" #columns").append(b),$("#"+MOEPROJECT.config.canvas+" #columns .pin:last img").error(function(){$(this).attr("src","resources/nophoto.jpg")}),MOEPROJECT.order.push(a),1==MOEPROJECT.config.show_detail&&$("#"+MOEPROJECT.config.canvas+" #columns .pin:last").addClass("opaque"),$("#"+MOEPROJECT.config.canvas+" #columns .pin:last").click(function(){MOEPROJECT.config.show_detail="showing";var a=MOEPROJECT.moegirls[MOEPROJECT.order[$(this).prevAll().length]];MOEPROJECT.showDetail(a)})},MOEPROJECT.showDetail=function(a){$("#"+MOEPROJECT.config.canvas+" #columns .pin").addClass("opaque"),$("#"+MOEPROJECT.config.canvas+" #detail span").empty(),$("#"+MOEPROJECT.config.canvas+" #detail a").attr("href","#"),$("#"+MOEPROJECT.config.canvas+" #detail img").attr("src","resources/nophoto.jpg");var b=$("#"+MOEPROJECT.config.canvas+" #detail table");b.empty(),b.append($('<tr><th class=""></th><th class=""></th></tr>'));for(var c in a)if("name"==c)$("#"+MOEPROJECT.config.canvas+" #detail span").html(a.name);else if("photo"==c)$("#"+MOEPROJECT.config.canvas+" #detail img").attr("src",a.photo);else if("link"==c)$("#"+MOEPROJECT.config.canvas+" #detail a").attr("href",a.link);else if("firstp"==c||"catlinks"==c);else{var d=c,e=a[c];if("array"==typeof a[c]||"object"==typeof a[c]){e="";for(var f in a[c])e+=a[c][f]+", ";e.length>2&&(e=e.substring(0,e.length-2))}e.length>30,b.append($("<tr><td>"+d+"</td><td>"+e+"</td></tr>"))}$("#"+MOEPROJECT.config.canvas+" #detail").hide().css({visibility:"inherit"}).fadeIn("slow")},MOEPROJ.MOECRAFT=MOEPROJ.MOECRAFT||new Object;var MOECRAFT=MOEPROJ.MOECRAFT;MOECRAFT.ui,MOECRAFT.data=["data/craft.json"],MOECRAFT.load=function(a){MOECRAFT.ui=MOEPROJ.MOECRAFTUI,MOECRAFT.ui.init(a),MOEPROJ.load({canvas:a,html:MOECRAFT.ui.html,data:MOECRAFT.data},MOECRAFT.run,MOECRAFT.loadData)},MOECRAFT.loadData=function(a){MOECRAFT.craft=MOECRAFT.craft.concat(a.formula);for(var b in a.formula)for(var c in a.formula[b])"input"==c?MOECRAFT.cards=MOECRAFT.cards.concat(a.formula[b][c]):"output"==c&&(MOECRAFT.cards=MOECRAFT.cards.concat(a.formula[b][c]))},MOECRAFT.run=function(){for(var a in MOECRAFT.craft)"input"in MOECRAFT.craft[a]&&MOECRAFT.craft[a].input.sort(),"output"in MOECRAFT.craft[a]&&MOECRAFT.craft[a].output.sort();MOECRAFT.ui.load();for(var a=0;5>a;++a)MOECRAFT.drawRandom()},MOECRAFT.craft=new Array,MOECRAFT.cards=new Array,MOECRAFT.table=new Array,MOECRAFT.lastId=0,MOECRAFT.myCards=new Object,MOECRAFT.drawRandom=function(){var a=Math.random(),b=Math.floor(a*MOECRAFT.cards.length),c={id:++MOECRAFT.lastId,num:b,name:MOECRAFT.cards[b],status:"hand"};return MOECRAFT.myCards[c.id]=c,MOECRAFT.ui.drawCard(c),c},MOECRAFT.putCardOnTable=function(a){a=parseInt(a.substr(5)),MOECRAFT.myCards[a].status="table",MOECRAFT.table.push(a)},MOECRAFT.takeCardBack=function(a){a=parseInt(a.substr(5));var b=MOECRAFT.table.indexOf(a);MOECRAFT.table.splice(b,1),MOECRAFT.myCards[a].status="hand"},MOECRAFT.doCraft=function(){var a=new Array;for(var b in MOECRAFT.table)a.push(MOECRAFT.myCards[MOECRAFT.table[b]].name);a.sort();for(var b in MOECRAFT.craft)if(MOECRAFT.craft[b].input.length==a.length){var c=!0;for(var d in MOECRAFT.craft[b].input)if(MOECRAFT.craft[b].input[d]!=a[d]){c=!1;break}if(c){var e=$.extend(!0,[],MOECRAFT.table);MOECRAFT.table=new Array;for(var d in MOECRAFT.craft[b].output){var f={id:++MOECRAFT.lastId,num:-1,name:MOECRAFT.craft[b].output[d],status:"table"};MOECRAFT.myCards[f.id]=f,MOECRAFT.table.push(f.id)}MOECRAFT.ui.doCraft(e,MOECRAFT.table);break}}},MOEPROJ.MOECRAFTUI=MOEPROJ.MOECRAFTUI||new Object;var MOECRAFTUI=MOEPROJ.MOECRAFTUI;MOECRAFTUI.html=' 	<div id="table"></div> 	<div id="hand"></div> 	<button id="craftbutton" type="button">craft</button> 	<button id="drawbutton" type="button">draw cards</button> ',MOECRAFTUI.init=function(a){document.title="萌娘合成",$("#"+a).addClass("moecraft")},MOECRAFTUI.load=function(){$("#"+MOEPROJ.config.canvas+" #table").droppable({drop:function(a,b){MOECRAFT.putCardOnTable(b.draggable[0].id);var c=$(b.draggable[0]).detach();$("#"+MOEPROJ.config.canvas+" #table").append(c)},out:function(a,b){MOECRAFT.takeCardBack(b.draggable[0].id)}}),$("#craftbutton").click(function(){MOECRAFT.doCraft()}),$("#drawbutton").click(function(){MOECRAFT.drawRandom()})},MOECRAFTUI.drawCard=function(a){$("#"+MOEPROJ.config.canvas+" #hand").append('<div id="card-'+a.id+'" class="card">'+a.name+"</div>");var b=$("#"+MOEPROJ.config.canvas+" #card-"+a.id);return b.draggable({stop:function(a){if(card_id=a.target.id.substr(5),"hand"==MOECRAFT.myCards[card_id].status){var b=$(a.target).detach();$("#"+MOEPROJ.config.canvas+" #hand").append(b)}$(a.target).css({top:"0px",left:"0px"})}}),b},MOECRAFTUI.doCraft=function(a,b){$(".moecraft #table .card").remove();for(var c in b){var d=MOECRAFTUI.drawCard(MOECRAFT.myCards[b[c]]),e=d.detach();$("#"+MOEPROJ.config.canvas+" #table").append(e)}};var MOEILLUSTRA=MOEILLUSTRA||new Object;MOEILLUSTRA.config={files:["data/moegirls.json"],canvas:void 0,count:0,current_illustra:0},MOEILLUSTRA.init=function(){function a(a){$.getJSON(a,function(b){console.log("loaded",a),MOEILLUSTRA.loadIllustra(b)}).fail(function(a,b,c){console.error("data load error",b,c)}).always(function(){})}for(var b in MOEILLUSTRA.config.files)a(MOEILLUSTRA.config.files[b])},$(function(){MOEILLUSTRA.init()}),MOEILLUSTRA.run=function(a){return void 0===a||0==$("#"+a).length?void console.error("undefined canvas",a):(MOEILLUSTRA.config.canvas=a,MOEILLUSTRA.showFrame(),void MOEILLUSTRA.waitLoad())},MOEILLUSTRA.waitLoad=function(){return 0==MOEILLUSTRA.illustra.length?(console.log("loading"),void setTimeout(MOEILLUSTRA.waitLoad,300)):void MOEILLUSTRA.showRandom()},MOEILLUSTRA.illustra=new Array,MOEILLUSTRA.loadIllustra=function(a){MOEILLUSTRA.illustra=MOEILLUSTRA.illustra.concat(a),console.log("loaded illustra ",MOEILLUSTRA.illustra.length)},MOEILLUSTRA.showFrame=function(){var a=$("#"+MOEILLUSTRA.config.canvas);a.empty(),a.append($('<a href="#" class="id-pagelink pagelink" target="_blank"><img border="0" src="resources/nophoto.jpg" alt="photo" width="20%" class="id-photo photo" /></a>')),$("#"+MOEILLUSTRA.config.canvas+" .id-photo").hide(),a.append($('<a href="#" class="id-randombutton randombutton">Random</a>')),$("#"+MOEILLUSTRA.config.canvas+" .id-randombutton").click(MOEILLUSTRA.showRandom),a.append($('<table class="id-table" border="0"></table>')),a.hide().css({visibility:"inherit"}).fadeIn("slow")},MOEILLUSTRA.showRandom=function(){var a=Math.floor(Math.random()*MOEILLUSTRA.illustra.length);MOEILLUSTRA.config.current_illustra=a,MOEILLUSTRA.showIllustra(MOEILLUSTRA.illustra[MOEILLUSTRA.config.current_illustra])},MOEILLUSTRA.showIllustra=function(a){var b=$("#"+MOEILLUSTRA.config.canvas+" .id-table");b.empty(),b.append($('<tr><th class="id-th0"></th><th class="id-th1"></th></tr>')),$("#"+MOEILLUSTRA.config.canvas+" .id-pagelink").attr("href","#"),$("#"+MOEILLUSTRA.config.canvas+" .id-photo").hide(),$("#"+MOEILLUSTRA.config.canvas+" .id-photo").attr("src","resources/nophoto.jpg");for(var c in a)if("photo"==c)$("#"+MOEILLUSTRA.config.canvas+" .id-photo").attr("src",a[c]);else if("link"==c)$("#"+MOEILLUSTRA.config.canvas+" .id-pagelink").attr("href",a.link);else if("firstp"==c||"catlinks"==c);else{var d=c;"name"==d&&(d="名字");var e=a[c];("array"==typeof a[c]||"object"==typeof a[c])&&(e=JSON.stringify(a[c])),e.length>30,b.append($("<tr><td>"+d+"</td><td>"+e+"</td></tr>"))
}$("#"+MOEILLUSTRA.config.canvas+" .id-photo").hide().css({visibility:"inherit"}).fadeIn("slow"),b.hide().css({visibility:"inherit"}).fadeIn("slow")};var MOEPROJ=MOEPROJ||new Object,urlparam=function(){for(var a={},b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if("undefined"==typeof a[e[0]])a[e[0]]=e[1];else if("string"==typeof a[e[0]]){var f=[a[e[0]],e[1]];a[e[0]]=f}else a[e[0]].push(e[1])}return a}();urlparam.hash=window.location.hash.length>0?window.location.hash.substring(1):"",MOEPROJ.config={canvas:"",html:"",code:new Array,data:new Array,ready:new Object},MOEPROJ.init=function(){$("#sidebar a").click(function(){var a=$(this).attr("id").substring(3);window.location.hash=a,MOEPROJ.run(a)})},MOEPROJ.run=function(a){var b=$("#sidebar a.active");switch(b.removeClass("active"),$("#sidebar #li-"+a).addClass("active"),$("#content div").hide(),$("#content #"+a).show(),a){case"cascade":MOEPROJECT.run("cascade");break;case"illustra":MOEILLUSTRA.run("illustra");break;case"quest":MOEQUEST.load("quest");break;case"battle":MOEBATTLE.load("battle");break;case"craft":MOECRAFT.load("craft");break;default:console.warn("no active page",a)}},MOEPROJ.load=function(a,b,c){if("canvas"in a){if(void 0===a.canvas||0==$("#"+a.canvas).length)return void console.error("undefined canvas",a.canvas);MOEPROJ.config.canvas=a.canvas}if("html"in a&&""!=a.html){MOEPROJ.config.html=a.html;var d=$("#"+MOEPROJ.config.canvas);d.empty(),d.append($(MOEPROJ.config.html)),$("#"+MOEPROJ.config.canvas+" img").error(function(){$(this).attr("src","resources/nophoto.jpg")}),d.hide().css({visibility:"inherit"}).fadeIn("slow")}if("code"in a)if("array"==typeof a.code||"object"==typeof a.code)for(var e in a.code)MOEPROJ.loadFile(a.code[e]);else MOEPROJ.loadFile(a.code);if("data"in a)if("array"==typeof a.data||"object"==typeof a.data)for(var e in a.data)MOEPROJ.loadFile(a.data[e],c);else MOEPROJ.loadFile(a.data,c);MOEPROJ.waitLoad(b)},MOEPROJ.waitLoad=function(a){var b=!0;for(var c in MOEPROJ.config.ready)if(!MOEPROJ.config.ready[c]){b=!1;break}b?a():setTimeout(function(){MOEPROJ.waitLoad(a)},300)},MOEPROJ.loadFile=function(a,b){if(!(a in MOEPROJ.config.ready))if(MOEPROJ.config.ready[a]=!1,".js"==a.substr(a.length-3))$.getScript(a).done(function(c,d){return MOEPROJ.config.ready[a]=!0,console.log("load",a),b(c,d)}).fail(function(a,b,c){console.error(c)});else{if(".css"==a.substr(a.length-4))return $("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",a)),MOEPROJ.config.ready[a]=!0,b();if(".json"==a.substr(a.length-5))return MOEPROJ.loadJson(a,b);MOEPROJ.config.ready[a]=!0}},MOEPROJ.loadJson=function(a,b){$.getJSON(a,function(c){MOEPROJ.config.ready[a]=!0,console.log("loaded",a),"function"==typeof b&&b(c)}).fail(function(a,b,c){console.error("data load error",b,c)}).always(function(){})},MOEPROJ.getFunctionFromString=function(a){var b=window,c=a.split(".");for(i=0;i<c.length-1;i++)if(b=b[c[i]],void 0==b)return;return b[c[c.length-1]]},MOEPROJ.MOEQUEST=MOEPROJ.MOEQUEST||new Object;var MOEQUEST=MOEPROJ.MOEQUEST;MOEQUEST.config={quest_num:1,option_num:4,quest:new Object,results:new Array},MOEQUEST.ui,MOEQUEST.data=["data/moegirls.json"],MOEQUEST.moegirls=new Array,MOEQUEST.load=function(a){MOEQUEST.ui=MOEPROJ.MOEQUESTUI,MOEQUEST.ui.init(a),MOEPROJ.load({canvas:a,html:MOEQUEST.ui.html,data:MOEQUEST.data},MOEQUEST.run,MOEQUEST.loadData)},MOEQUEST.loadData=function(a){MOEQUEST.moegirls=MOEQUEST.moegirls.concat(a)},MOEQUEST.run=function(){MOEQUEST.ui.load();for(var a=0;a<MOEQUEST.config.quest_num;++a)MOEQUEST.createQuest()},MOEQUEST.createQuest=function(){for(var a=void 0;void 0===a;)a=MOEQUEST.createMoegirlQuest();return MOEQUEST.config.quest=a,MOEQUEST.ui.showQuest(MOEQUEST.config.quest),MOEQUEST.config.quest},MOEQUEST.createMoegirlQuest=function(){var a={question:"",question_img:void 0,options:[],option_img:[],option_link:[],correct:[]},b=new Array;if(MOEQUEST.moegirls.length<MOEQUEST.config.option_num)for(var c in MOEQUEST.moegirls)b.push(c);else for(;b.length<MOEQUEST.config.option_num;){var d=Math.floor(Math.random()*MOEQUEST.moegirls.length);-1==b.indexOf(d)&&b.push(d)}var e=["photo","发色","瞳色","声优","生日","年龄","身高","体重"],d=Math.floor(Math.random()*e.length),f=new Array;for(var c in b)if(void 0!==MOEQUEST.moegirls[b[c]][e[d]]){f.push(b[c]);break}if(0==f.length)return void console.warn("question attr fails to find a good choice",e[d]);var g=Math.floor(Math.random()*f.length);if(b.indexOf(f[g])<=-1)return void console.warn("invalid answer",MOEQUEST.moegirls[f[g]].name);for(var h,i,c=b.length;c;h=Math.floor(Math.random()*c),i=b[--c],b[c]=b[h],b[h]=i);for(var c in b)MOEQUEST.moegirls[f[g]][e[d]]==MOEQUEST.moegirls[b[c]][e[d]]&&a.correct.push(c);for(var c in b)a.options.push(MOEQUEST.moegirls[b[c]].name),"photo"!=e[d]&&a.option_img.push(MOEQUEST.moegirls[b[c]].photo||""),a.option_link.push(MOEQUEST.moegirls[b[c]].link||"");switch(e[d]){case"photo":a.question="该图片是哪位萌娘？",a.question_img=MOEQUEST.moegirls[f[g]].photo;break;case"发色":case"瞳色":case"声优":case"生日":case"年龄":case"身高":case"体重":a.question="哪位萌娘的<em>"+e[d]+"</em>是<strong>"+MOEQUEST.moegirls[f[g]][e[d]]+"</strong>？";break;default:return void(a.question="答案是哪位萌娘？")}return a},MOEPROJ.MOEQUESTUI=MOEPROJ.MOEQUESTUI||new Object;var MOEQUESTUI=MOEPROJ.MOEQUESTUI;MOEQUESTUI.html=' <div id="question"> 	<span></span> 	<img src="" alt="question" class="" /> </div> <img border="0" src="resources/correct.ico" alt="result" width="10%" id="result" /> <a href="#" id="submitbutton">Answer</a> <div class="optionsection" /> ',MOEQUESTUI.init=function(a){document.title="萌娘问答",$("#"+a).addClass("moequest")},MOEQUESTUI.load=function(){$("#"+MOEPROJ.config.canvas+" #question img").error(function(){$(this).attr("src","resources/nophoto.jpg")});for(var a=$("#"+MOEPROJ.config.canvas+" .optionsection"),b=0;b<MOEQUEST.config.option_num;++b)a.append($('<div id="option'+b+'" class="option" ><a href="#" class="inactive" target="_blank"><span></span><img src="" alt="option'+b+'" class="" /></a></div>')),$("#"+MOEPROJ.config.canvas+" #option"+b+" img").error(function(){$(this).attr("src","resources/nophoto.jpg")}),$("#"+MOEPROJ.config.canvas+" #option"+b).hover(function(){$(this).hasClass("checked")||$(this).addClass("hover")},function(){$(this).removeClass("hover")}),$("#"+MOEPROJ.config.canvas+" #option"+b).click(function(){$(this).toggleClass("checked")})},MOEQUESTUI.showQuest=function(a){window.peek=MOEQUEST.config.quest.correct,MOEQUEST.clearChecked(),$("#"+MOEPROJ.config.canvas+" #result").hide(),$("#"+MOEPROJ.config.canvas+" #submitbutton").off("click").on("click",function(){MOEQUEST.checkAnswer()}).html("Answer"),$("#"+MOEPROJ.config.canvas+" #question span").html(a.question),void 0!==a.question_img?($("#"+MOEPROJ.config.canvas+" #question img").attr("src",a.question_img),$("#"+MOEPROJ.config.canvas+" #question img").addClass("show"),$("#"+MOEPROJ.config.canvas+" .option").addClass("bottom")):($("#"+MOEPROJ.config.canvas+" #question img").attr("src",""),$("#"+MOEPROJ.config.canvas+" #question img").removeClass("show"),$("#"+MOEPROJ.config.canvas+" .option").removeClass("bottom")),$("#"+MOEPROJ.config.canvas+" .option").removeClass("correct"),$("#"+MOEPROJ.config.canvas+" .option a").addClass("inactive");for(var b=0;b<a.options.length;++b){var c=$("#"+MOEPROJ.config.canvas+" #option"+b+" span");if(0==c.length){console.warn("option canvas not enough",b,a.options);break}c.html(a.options[b]),void 0!==a.option_img&&void 0!==a.option_img[b]?($("#"+MOEPROJ.config.canvas+" #option"+b+" img").attr("src",a.option_img[b]),$("#"+MOEPROJ.config.canvas+" #option"+b+" img").addClass("show")):($("#"+MOEPROJ.config.canvas+" #option"+b+" img").attr("src",""),$("#"+MOEPROJ.config.canvas+" #option"+b+" img").removeClass("show"))}$("#"+MOEPROJ.config.canvas+" #question").hide().css({visibility:"inherit"}).fadeIn("slow"),$("#"+MOEPROJ.config.canvas+" .option").hide().css({visibility:"inherit"}).fadeIn("slow")},MOEQUEST.showAnswer=function(a){MOEQUEST.clearChecked();for(var b in a.correct){var c=$("#"+MOEPROJ.config.canvas+" #option"+a.correct[b]);0!=c.length?c.addClass("correct"):console.warn("correct answer does not exist",b)}$("#"+MOEPROJ.config.canvas+" #submitbutton").off("click").on("click",function(){MOEQUEST.createQuest()}).html("Next"),$("#"+MOEPROJ.config.canvas+" .option a").each(function(b){$(this).attr("href",a.option_link[b]),$(this).removeClass("inactive")})},MOEQUEST.checkAnswer=function(){var a=MOEQUEST.config.quest,b=new Array;$("#"+MOEPROJ.config.canvas+" .optionsection .option").each(function(a,c){$(c).hasClass("checked")&&b.push(a)});var c=!1;if(b.length!=a.correct.length)c=!0;else{b.sort(),a.correct.sort();for(var d in b)if(!(d in a.correct)||b[d]!=a.correct[d]){c=!0;break}}MOEQUEST.config.results.push(!c),$("#"+MOEPROJ.config.canvas+" #result").attr("src","resources/"+(c?"incorrect":"correct")+".ico").hide().css({visibility:"inherit"}).fadeIn("slow"),MOEQUEST.showAnswer(a)},MOEQUEST.clearChecked=function(){$("#"+MOEPROJ.config.canvas+" .optionsection .checked").each(function(a,b){$(b).removeClass("checked")})};var MOEPROJ=MOEPROJ||new Object,MOEPARSER=MOEPROJ.MOEPARSER||new Object,fs=require("fs"),jsdom=require("jsdom");MOEPARSER.ENTRY_URL=["http://feizhan.github.io/moeproject/resources/%E5%8D%83%E7%9F%B3%E6%8A%9A%E5%AD%90%20-%20%E8%90%8C%E5%A8%98%E7%99%BE%E7%A7%91_%E4%B8%87%E7%89%A9%E7%9A%86%E5%8F%AF%E8%90%8C%E7%9A%84%E7%99%BE%E7%A7%91%E5%85%A8%E4%B9%A6.html"],MOEPARSER.contents=new Object,MOEPARSER.parse=function(){for(var a in MOEPARSER.ENTRY_URL)MOEPARSER.parsePage(MOEPARSER.ENTRY_URL[a])},MOEPARSER.parsePage=function(a){a in MOEPARSER.contents||jsdom.env(a,["http://code.jquery.com/jquery.js"],function(b,c){if(b)return void console.error("error parsing url",b);if(void 0===MOEPARSER.contents[a]&&(MOEPARSER.contents[a]=new Object),MOEPARSER.contents[a].name=MOEPARSER.parseDom(c,"#firstHeading > span"),void 0===MOEPARSER.contents[a].name)return void console.warn(c.$("p").html());MOEPARSER.contents[a].first=MOEPARSER.parseDom(c,"#mw-content-text > p:nth-child(4)"),MOEPARSER.contents[a].links=new Array,c.$("#mw-content-text a").each(function(){MOEPARSER.contents[a].links.push(c.$(this).attr("href"))}),MOEPARSER.contents[a].photo=c.$("#mw-content-text > div.infotemplatebox > table > tr:nth-child(1) > td > a > img").attr("src"),MOEPARSER.contents[a].info=new Object;var d=c.$("#mw-content-text > div.infotemplatebox > table > tr");d.each(function(b){var d=c.$("#mw-content-text > div.infotemplatebox > table > tr:nth-child("+b+") > th").text();if(d=d.replace(/\s/g,""),void 0!==d&&""!=d&&" "!=d){var e=c.$("#mw-content-text > div.infotemplatebox > table > tr:nth-child("+b+") > td").text();e=e.replace(/^\s+|\s+$/g,"").replace(/(\r\n|\n|\r)/gm,""),MOEPARSER.contents[a].info[d]=e}}),MOEPARSER.contents[a].categories=new Array;var e=c.$("#mw-normal-catlinks > ul > li");e.each(function(){var b=c.$(this).text();b=b.replace(/^\s+|\s+$/g,"").replace(/(\r\n|\n|\r)/gm,""),MOEPARSER.contents[a].categories.push(b)});var f=MOEPARSER.contents[a].name;f="data/raw/"+f+".json",fs.writeFile(f,JSON.stringify(MOEPARSER.contents[a],null,4),function(a){a?console.log("file error",a):console.log("JSON saved to "+f)}),console.log(MOEPARSER.contents[a].name,MOEPARSER.contents[a].info)})},MOEPARSER.parseDom=function(a,b){return a.$(b).html()},MOEPARSER.parseDomAll=function(a,b){var c=new Array;return a.$(b).each(function(){c.push(a.$(this).html())}),c},MOEPARSER.separate=function(){var a=require("../data/raw.json"),b=0;for(var c in a)if(++b,"object"==typeof a[c]&&"name"in a[c]){var d=a[c].name;d="data/raw/"+d+".json",fs.writeFile(d,JSON.stringify(a[c],null,4),function(a){a?console.log("file error",a):console.log("JSON saved to "+d)})}console.log(b)},MOEPARSER.parse();var http=require("http"),url=require("url"),path=require("path"),fs=require("fs");port=process.argv[2]||8080,http.createServer(function(a,b){var c=url.parse(a.url).pathname,d=path.join(process.cwd(),c),e={".html":"text/html",".css":"text/css",".js":"text/javascript"};path.exists(d,function(a){return a?(fs.statSync(d).isDirectory()&&(d+="../index.html"),void fs.readFile(d,"binary",function(a,c){if(a)return b.writeHead(500,{"Content-Type":"text/plain"}),b.write(a+"\n"),void b.end();var f={},g=e[path.extname(d)];g&&(f["Content-Type"]=g),b.writeHead(200,f),b.write(c,"binary"),b.end()})):(b.writeHead(404,{"Content-Type":"text/plain"}),b.write("404 Not Found\n"),void b.end())})}).listen(parseInt(port,10)),console.log("Static file server running at\n  => http://localhost:"+port+"/\nCTRL + C to shutdown");