/*! moebattle.js 2014-06-15 */
MOEPROJ.MOEBATTLE=MOEPROJ.MOEBATTLE||new Object;var MOEBATTLE=MOEPROJ.MOEBATTLE;MOEBATTLE.ui,MOEBATTLE.data=["data/battle.json"],MOEBATTLE.load=function(a){MOEBATTLE.ui=MOEPROJ.MOEBATTLEUI,MOEBATTLE.ui.init(a),MOEPROJ.load({canvas:a,html:MOEBATTLE.ui.html,data:MOEBATTLE.data},MOEBATTLE.run,MOEBATTLE.loadData)},MOEBATTLE.loadData=function(a){MOEBATTLE.battle=a,MOEBATTLE.cards=MOEBATTLE.cards.concat(a.cards)},MOEBATTLE.run=function(){MOEBATTLE.ui.load(),MOEBATTLE.actions.push({type:"gameStart"}),setInterval(function(){MOEBATTLE.nextAction()},100)},MOEBATTLE.game={orders:[0,1],deck:new Array,discard:new Array,round_count:0,shuffle_count:0,current:-1},MOEBATTLE.battle=new Array,MOEBATTLE.cards=new Array,MOEBATTLE.players=[{name:"me",order:0,maxhp:20,hp:20,maxmp:0,mp:0,hands:[],area:[],status:[],equip:[]},{name:"opponent",order:1,maxhp:20,hp:20,maxmp:0,mp:0,hands:[],area:[],status:[],equip:[]}],MOEBATTLE.actions=new Array,MOEBATTLE.nextAction=function(){if(!(0==MOEBATTLE.actions.length||MOEBATTLE.ui.AnimaCount>0)){var a=MOEBATTLE.actions.shift();void 0!==a.type&&(console.debug(a.type),"function"==typeof MOEBATTLE[a.type]&&MOEBATTLE[a.type](a))}},MOEBATTLE.gameStart=function(){for(var a in MOEBATTLE.players)MOEBATTLE.ui.playerPrepare(a);MOEBATTLE.game.discard=new Array,MOEBATTLE.game.deck=new Array;for(var a in MOEBATTLE.cards)MOEBATTLE.game.deck.push(a);MOEBATTLE.shuffle(MOEBATTLE.game.deck);var b=new Array;b.push({type:"playersShuffle"});for(var a in MOEBATTLE.game.orders)b.push({type:"cardsDraw",number:1,target:MOEBATTLE.game.orders[a]});MOEBATTLE.actions=b.concat(MOEBATTLE.actions),MOEBATTLE.actions.push({type:"playerStart"})},MOEBATTLE.gameOver=function(){MOEBATTLE.ui.gameOver()},MOEBATTLE.gamePause=function(){},MOEBATTLE.gamePause=function(){},MOEBATTLE.gameWin=function(){},MOEBATTLE.gameLose=function(){},MOEBATTLE.gameDraw=function(){},MOEBATTLE.deckShuffle=function(){MOEBATTLE.shuffle(MOEBATTLE.game.deck),++MOEBATTLE.game.shuffle_count},MOEBATTLE.shuffle=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);},MOEBATTLE.deckPrepare=function(){MOEBATTLE.game.deck=MOEBATTLE.game.deck.concat(MOEBATTLE.game.discard),MOEBATTLE.game.discard=new Array,MOEBATTLE.actions.unshift({type:"deckShuffle"})},MOEBATTLE.playersShuffle=function(){MOEBATTLE.game.orders=new Array;for(var a in MOEBATTLE.players)MOEBATTLE.game.orders.push(a);MOEBATTLE.shuffle(MOEBATTLE.game.orders);for(var a in MOEBATTLE.players)MOEBATTLE.players[a].order=MOEBATTLE.game.orders[a]},MOEBATTLE.playerStart=function(){++MOEBATTLE.game.current,MOEBATTLE.game.current>=MOEBATTLE.players.length&&(MOEBATTLE.game.current%=MOEBATTLE.players.length,++MOEBATTLE.game.round_count),MOEBATTLE.ui.playerStart(),MOEBATTLE.players[MOEBATTLE.game.current].maxmp<10&&(MOEBATTLE.actions.unshift({type:"playerGainMP",target:MOEBATTLE.game.current,number:1}),MOEBATTLE.actions.unshift({type:"playerChangeMaxMP",target:MOEBATTLE.game.current,number:MOEBATTLE.players[MOEBATTLE.game.current].maxmp+1})),MOEBATTLE.actions.push({type:"cardsDraw",number:1,target:MOEBATTLE.game.current})},MOEBATTLE.playerEnd=function(){MOEBATTLE.ui.playerEnd(),MOEBATTLE.actions.push({type:"playerStart"})},MOEBATTLE.playerChange=function(){},MOEBATTLE.playerDie=function(){},MOEBATTLE.playerRevive=function(){},MOEBATTLE.playerLoseHP=function(a){MOEBATTLE.players[a.target].hp-=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.playerGainHP=function(a){MOEBATTLE.players[a.target].hp+=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.playerChangeMaxHP=function(a){MOEBATTLE.players[a.target].maxhp=a.number,MOEBATTLE.ui.playerChangeMaxHP(a.target,a.number)},MOEBATTLE.playerLoseMP=function(a){MOEBATTLE.players[a.target].mp-=a.number,MOEBATTLE.ui.playerChangeMP(a.target,MOEBATTLE.players[a.target].mp)},MOEBATTLE.playerGainMP=function(a){MOEBATTLE.players[a.target].mp+=a.number,MOEBATTLE.ui.playerChangeMP(a.target,MOEBATTLE.players[a.target].mp)},MOEBATTLE.playerChangeMaxMP=function(a){MOEBATTLE.players[a.target].maxmp=a.number,MOEBATTLE.ui.playerChangeMaxMP(a.target,a.number)},MOEBATTLE.playerLoseStatus=function(a){MOEBATTLE.players[a.target].status.splice(MOEBATTLE.players[a.target].status.indexOf(a.status),1),MOEBATTLE.ui.playerLoseStatus(a.target,a.status)},MOEBATTLE.playerGainStatus=function(a){MOEBATTLE.players[a.target].status.indexOf(a.status)>=0,MOEBATTLE.players[a.target].status.push(a.status),MOEBATTLE.ui.playerGainStatus(a.target,a.status)},MOEBATTLE.playerGainEquip=function(){},MOEBATTLE.cardsDraw=function(a){if(!(a.number<=0||a.target<0||a.target>=MOEBATTLE.players.length)){if(a.number>MOEBATTLE.game.deck.length&&MOEBATTLE.deckPrepare(),a.number>MOEBATTLE.game.deck.length)return void MOEBATTLE.actions.unshift({type:"gameOver"});for(var b=0;b<a.number;++b)MOEBATTLE.actions.unshift({type:"cardDraw",target:a.target,from:a.from})}},MOEBATTLE.cardDraw=function(a){var b=MOEBATTLE.game.deck.pop();MOEBATTLE.players[a.target].hands.push(b),MOEBATTLE.ui.cardDraw(a.target,b,a.from)},MOEBATTLE.cardDiscard=function(){},MOEBATTLE.cardUse=function(a){switch(MOEBATTLE.players[a.from].hands.splice(MOEBATTLE.players[a.from].hands.indexOf(a.card),1),MOEBATTLE.cards[a.card].type){case"character":MOEBATTLE.actions.unshift({type:"cardAddToArea",card:a.card,from:a.from});break;case"effect":default:MOEBATTLE.actions.unshift({type:"cardUseWithoutTarget",from:a.from,card:a.card})}},MOEBATTLE.cardAddToArea=function(a){MOEBATTLE.players[a.from].area.push(a.card),MOEBATTLE.ui.cardAddToArea(a.card,a.from)},MOEBATTLE.cardUseWithoutTarget=function(a){if("skill"in MOEBATTLE.cards[a.card]){var b=MOEPROJ.getFunctionFromString(MOEBATTLE.cards[a.card].skill);"function"==typeof b&&b(a)}MOEBATTLE.game.discard.push(a.card),MOEBATTLE.ui.cardUseWithoutTarget(a.card)},MOEBATTLE.cardUseWithTarget=function(a){if("skill"in MOEBATTLE.cards[a.card]){var b=MOEPROJ.getFunctionFromString(MOEBATTLE.cards[a.card].skill);"function"==typeof b&&b(a)}MOEBATTLE.game.discard.push(a.card),MOEBATTLE.ui.cardUseWithoutTarget(a.card)},MOEBATTLE.charLoseHP=function(a){MOEBATTLE.players[a.target].hp-=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.charGainHP=function(a){MOEBATTLE.players[a.target].hp+=a.number,MOEBATTLE.ui.playerChangeHP(a.target,MOEBATTLE.players[a.target].hp)},MOEBATTLE.charLoseStatus=function(a){MOEBATTLE.players[a.target].status.splice(MOEBATTLE.players[a.target].status.indexOf(a.status),1),MOEBATTLE.ui.playerLoseStatus(a.target,a.status)},MOEBATTLE.charGainStatus=function(a){MOEBATTLE.players[a.target].status.indexOf(a.status)>=0,MOEBATTLE.players[a.target].status.push(a.status),MOEBATTLE.ui.playerGainStatus(a.target,a.status)},MOEPROJ.MOEBATTLE=MOEPROJ.MOEBATTLE||new Object,MOEPROJ.MOEBATTLE.SKILLS=MOEPROJ.MOEBATTLE.SKILLS||new Object;var SKILLS=MOEPROJ.MOEBATTLE.SKILLS;SKILLS.loseHP=function(a){MOEBATTLE.actions.unshift({type:"playerLoseHP",target:a.from?0:1,number:1})},SKILLS.charLoseHP=function(a){MOEBATTLE.actions.unshift({type:"charLoseHP",target:a.target,number:1,card:a.card})},SKILLS.drawCard=function(a){MOEBATTLE.actions.unshift({type:"cardsDraw",target:a.from,number:2})},SKILLS.gainPositiveStatus=function(a){MOEBATTLE.actions.unshift({type:"playerGainStatus",target:a.from,status:0})},MOEPROJ.MOEBATTLEUI=MOEPROJ.MOEBATTLEUI||new Object;var MOEBATTLEUI=MOEPROJ.MOEBATTLEUI;MOEBATTLEUI.html=' <div id="board"></div> <div id="myhand" class="hand"></div> <div id="yourhand" class="hand"></div> <a href="#" id="endbutton" class="button disable">结束</a> <div id="myhead" class="head"> 	<img src="#" alt="photo" class="" /> 	<div class="hp"> 		<span>0</span> / <span>0</span> 	</div> 	<div class="mp"> 		<span>0</span> / <span>0</span> 	</div> </div> <div id="yourhead" class="head"> 	<img src="#" alt="photo" class="" /> 	<div class="hp"> 		<span>0</span> / <span>0</span> 	</div> 	<div class="mp"> 		<span>0</span> / <span>0</span> 	</div> </div> <div id="mystatusarea" class="statusarea"></div> <div id="yourstatusarea" class="statusarea"></div> <div id="myarea" class="area"></div> <div id="yourarea" class="area"></div> <div id="arrow"> 	<canvas /> </div> <div id="anime"> 	<img src="#" alt="anime" class="" /> </div> <div id="detail"> 	<div class="name"></div> 	<div class="cost"></div> 	<div class="def"></div> 	<div class="atk"></div> 	<div class="card-hp"></div> 	<img src="#" alt="photo" class="" /> 	<div class="card-detail"></div> </div> ',MOEBATTLEUI.init=function(a){document.title="萌娘对战",$("#"+a).addClass("moebattle")},MOEBATTLEUI.load=function(){$("#"+MOEPROJ.config.canvas+" #endbutton").on("click",function(){$(this).hasClass("disable")||MOEBATTLE.actions.push({type:"playerEnd"})}),$("#"+MOEPROJ.config.canvas+" #board").droppable({drop:function(a,b){var c=b.draggable[0].id;void 0!==c&&(c=c.substring(5),c in MOEBATTLE.cards&&MOEBATTLEUI.cardDrop(c))},out:function(a,b){var c=b.draggable[0].id;void 0!==c&&(c=c.substring(5),c in MOEBATTLE.cards)}});var a=$("#"+MOEPROJ.config.canvas+" #arrow canvas")[0].getContext("2d");a.fillStyle="yellow",a.beginPath(),a.moveTo(150,0),a.lineTo(0,45),a.lineTo(100,45),a.lineTo(100,150),a.lineTo(200,150),a.lineTo(200,45),a.lineTo(300,45),a.closePath(),a.fill()},MOEBATTLEUI.AnimaCount=0,MOEBATTLEUI.detail_lock=!1,MOEBATTLEUI.showDetail=function(a,b,c){if(!MOEBATTLEUI.detail_lock){MOEBATTLEUI.detail_lock=!0;var d;switch(b){case"icon":d=$("#"+MOEPROJ.config.canvas+" #icon-"+a);break;case"status":d=$("#"+MOEPROJ.config.canvas+" #status-"+a);break;case"card":default:d=$("#"+MOEPROJ.config.canvas+" #card-"+a)}if(0==d.length)return $("#"+MOEPROJ.config.canvas+" #detail");MOEBATTLEUI.addDetailContent(a,b);var e=$("#"+MOEPROJ.config.canvas+" #detail");return e.show().css("visibility","inherit"),++MOEBATTLEUI.AnimaCount,MOEBATTLEUI.chooseDetailDir(e,c,d),$("#"+MOEPROJ.config.canvas+" #detail")}},MOEBATTLEUI.addDetailContent=function(a,b){switch(b){case"status":$("#"+MOEPROJ.config.canvas+" #detail .name").html(MOEBATTLE.battle.status[status].name),$("#"+MOEPROJ.config.canvas+" #detail img").attr("src",MOEBATTLE.battle.status[status].photo||""),$("#"+MOEPROJ.config.canvas+" #detail .card-detail").html(MOEBATTLE.battle.status[status].detail||"detaildetaildetaildetaildetaildetaildet aildetaildetaildetaildetaildetaildetaildetaildetaild etaildetaildetaildetaildetaildetaildetaildetaildeta ildetaildetail");break;case"card":case"icon":default:$("#"+MOEPROJ.config.canvas+" #detail .name").html(MOEBATTLE.cards[a].name),$("#"+MOEPROJ.config.canvas+" #detail img").attr("src",MOEBATTLE.cards[a].photo||""),MOEBATTLE.cards[a].cost?$("#"+MOEPROJ.config.canvas+" #detail .cost").html("cost: "+MOEBATTLE.cards[a].cost):$("#"+MOEPROJ.config.canvas+" #detail .cost").html("cost: N/A").hide(),MOEBATTLE.cards[a].atk?$("#"+MOEPROJ.config.canvas+" #detail .atk").html("moe point: "+(MOEBATTLE.cards[a].atk||0)):$("#"+MOEPROJ.config.canvas+" #detail .atk").html("moe point: N/A").hide(),MOEBATTLE.cards[a].hp?$("#"+MOEPROJ.config.canvas+" #detail .card-hp").html("hp: "+(MOEBATTLE.cards[a].hp||0)):$("#"+MOEPROJ.config.canvas+" #detail .card-hp").html("hp: N/A").hide(),$("#"+MOEPROJ.config.canvas+" #detail .card-detail").html(MOEBATTLE.cards[a].detail||"detaildetaildetaildetaildetaildetaildet aildetaildetaildetaildetaildetaildetaildetaildetaild etaildetaildetaildetaildetaildetaildetaildetaildeta ildetaildetail")}},MOEBATTLEUI.chooseDetailDir=function(a,b,c){if(void 0===b||"auto"==b){var d=c.offset();b=d.top<200?"down":d.top+200>$(window).height()?"up":d.left<$(window).width()/2?"right":"left"}switch(b){case"up":a.css({top:c.offset().top,left:c.offset().left-90,height:"0%",width:c.width()}).animate({top:"-=400px",left:"-=120px",height:"+=400px",width:"+=240px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"down":a.css({top:c.offset().top+c.height(),left:c.offset().left-90,height:"0%",width:c.width()}).animate({left:"-=120px",height:"+=400px",width:"+=240px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"left":a.css({top:c.offset().top,left:c.offset().left-90,height:c.height(),width:"0%"}).animate({top:"-=200px",left:"-=360px",height:"+=400px",width:"+=360px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"right":a.css({top:c.offset().top,left:c.offset().left-90+c.width(),height:c.height(),width:"0%"}).animate({top:"-=200px",height:"+=400px",width:"+=360px"},"fast",function(){--MOEBATTLEUI.AnimaCount});break;case"none":case 0:default:--MOEBATTLEUI.AnimaCount}},MOEBATTLEUI.hideDetail=function(){$("#"+MOEPROJ.config.canvas+" #detail").fadeOut("slow",function(){MOEBATTLEUI.detail_lock=!1})},MOEBATTLEUI.arrow={status:"idle"},MOEBATTLEUI.arrowFollow=function(a,b){if("follow"!=MOEBATTLEUI.arrow.status){var c=$("#"+MOEPROJ.config.canvas+" #card-"+a);if(0==c.length&&(c=$("#"+MOEPROJ.config.canvas+" #icon-"+a)),0!=c.length){++MOEBATTLEUI.AnimaCount,MOEBATTLEUI.arrow.status="follow";for(var d=c.position().top+c.height()/2,e=c.position().left+c.width()/2,f=c.parent();void 0!==f&&f.attr("id")!=MOEPROJ.config.canvas;)e+=f.position().left,d+=f.position().top,f=f.parent();var g=function(a){var b=a.pageX-$("#"+MOEPROJ.config.canvas).offset().left,c=a.pageY-$("#"+MOEPROJ.config.canvas).offset().top,f=Math.sqrt((b-e)*(b-e)+(c-d)*(c-d)),g=(b+e)/2-25,h=(c+d)/2-f/2;$("#"+MOEPROJ.config.canvas+" #arrow").height(f);var i=180*Math.atan2(c-d,b-e)/Math.PI+90;$("#"+MOEPROJ.config.canvas+" #arrow").css({top:h,left:g}).css({WebkitTransform:"rotate("+i+"deg)"}).css({"-moz-transform":"rotate("+i+"deg)"}).css({visibility:"inherit"}).show()},h=function(){a!=MOEBATTLEUI.selectedIcon&&(void 0===MOEBATTLEUI.selectedIcon,$("html").off("mousemove",g).off("click",h),$("#"+MOEPROJ.config.canvas+" #arrow").hide(),MOEBATTLEUI.arrow.status="idle","function"==typeof b&&b(a,MOEBATTLEUI.selectedIcon),--MOEBATTLEUI.AnimaCount)};$("html").on("mousemove",g).on("click",h)}}},MOEBATTLEUI.gameOver=function(){console.log("game over")},MOEBATTLEUI.playerPrepare=function(a){if(++MOEBATTLEUI.AnimaCount,0==a){var b=$("#"+MOEPROJ.config.canvas+" #myhead .hp span");$(b[0]).html(MOEBATTLE.players[a].hp),$(b[1]).html(MOEBATTLE.players[a].maxhp),b=$("#"+MOEPROJ.config.canvas+" #myhead .mp span"),$(b[0]).html(MOEBATTLE.players[a].mp),$(b[1]).html(MOEBATTLE.players[a].maxmp)}else if(1==a){var b=$("#"+MOEPROJ.config.canvas+" #yourhead .hp span");$(b[0]).html(MOEBATTLE.players[a].hp),$(b[1]).html(MOEBATTLE.players[a].maxhp),b=$("#"+MOEPROJ.config.canvas+" #yourhead .mp span"),$(b[0]).html(MOEBATTLE.players[a].mp),$(b[1]).html(MOEBATTLE.players[a].maxmp)}--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.playerStart=function(){++MOEBATTLEUI.AnimaCount,$("#battle .hand.turn").removeClass("turn"),0==MOEBATTLE.game.current?$("#battle #myhand").addClass("turn"):$("#battle #yourhand").addClass("turn"),0==MOEBATTLE.game.current?$("#"+MOEPROJ.config.canvas+" #endbutton").removeClass("disable"):setTimeout(function(){MOEBATTLE.actions.push({type:"playerEnd"})},1e3),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.playerEnd=function(){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #endbutton").addClass("disable"),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.playerChangeHP=function(a,b){0==a?$("#"+MOEPROJ.config.canvas+" #myhead .hp span").html(b):$("#"+MOEPROJ.config.canvas+" #yourhead .hp span").html(b)},MOEBATTLEUI.playerChangeMaxHP=function(a,b){0==a?$($("#"+MOEPROJ.config.canvas+" #myhead .hp span")[1]).html(b):$($("#"+MOEPROJ.config.canvas+" #yourhead .hp span")[1]).html(b)},MOEBATTLEUI.playerChangeMP=function(a,b){0==a?$("#"+MOEPROJ.config.canvas+" #myhead .mp span").html(b):$("#"+MOEPROJ.config.canvas+" #yourhead .mp span").html(b)},MOEBATTLEUI.playerChangeMaxMP=function(a,b){0==a?$($("#"+MOEPROJ.config.canvas+" #myhead .mp span")[1]).html(b):$($("#"+MOEPROJ.config.canvas+" #yourhead .mp span")[1]).html(b)},MOEBATTLEUI.playerLoseStatus=function(a,b){0==a?$("#"+MOEPROJ.config.canvas+" #mystatusarea #status-"+b).remove():$("#"+MOEPROJ.config.canvas+" #yourstatusarea #status-"+b).remove()},MOEBATTLEUI.playerGainStatus=function(a,b){MOEBATTLEUI.createStatus(a,b)},MOEBATTLEUI.createCard=function(a){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas).append(' 		<div id="card-'+a+'" class=" card"> 			<span>test</span> 			<img src="" alt="photo" /> 			<div class="card-detail"></div> 			<div class="cost param"></div> 			<div class="def param"></div> 			<div class="atk param"></div> 			<div class="card-hp param"></div> 		</div> 	');var b=$("#"+MOEPROJ.config.canvas+" #card-"+a);return b.draggable({stop:function(){$(this).hasClass("inhand")&&$(this).css({top:"0px",left:"0px"})}}),$("#"+MOEPROJ.config.canvas+" #card-"+a+" span").html(MOEBATTLE.cards[a].name),$("#"+MOEPROJ.config.canvas+" #card-"+a+" img").attr("src",MOEBATTLE.cards[a].photo).error(function(){$(this).attr("src","resources/nophoto.jpg")}),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.card-detail").html(MOEBATTLE.cards[a].detail),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.cost").html(MOEBATTLE.cards[a].cost||0),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.def").html(MOEBATTLE.cards[a].def||0),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.atk").html(MOEBATTLE.cards[a].atk||0),$("#"+MOEPROJ.config.canvas+" #card-"+a+" div.card-hp").html(MOEBATTLE.cards[a].hp||0),b.hover(function(){$(this).css("z-index",1);var b=MOEBATTLEUI.showDetail(a,"card");return void 0===b?void console.warn("fail to drawCardAnima"):void 0},function(){$(this).css("z-index",0),MOEBATTLEUI.hideDetail()}),--MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #card-"+a)},MOEBATTLEUI.cardDrop=function(a){++MOEBATTLEUI.AnimaCount;var b=$("#"+MOEPROJ.config.canvas+" #card-"+a);if(0!=MOEBATTLE.game.current)return void b.animate({top:"70%",left:"45%"},"slow",function(){--MOEBATTLEUI.AnimaCount});var c=0;b.hasClass("myhand")?c=0:b.hasClass("yourhand")&&(c=1);var d=b.position().top+b.parent().position().top,e=b.position().left+b.parent().position().left;$("#"+MOEPROJ.config.canvas).append(b.detach()),b.removeClass("inhand myhand yourhand"),b.css({top:d,left:e}),void 0!==MOEBATTLE.cards[a].target?MOEBATTLEUI.arrowFollow(a,function(){return void 0===MOEBATTLEUI.selectedIcon?(0==c?($("#"+MOEPROJ.config.canvas+" #myhand").append(b.detach()),b.addClass("inhand myhand")):($("#"+MOEPROJ.config.canvas+" #yourhand").append(b.detach()),b.addClass("inhand yourhand")),void b.css({top:"0px",left:"0px"})):void MOEBATTLE.actions.unshift({type:"cardUseWithTarget",card:a,target:MOEBATTLEUI.selectedIcon})}):MOEBATTLE.actions.unshift({type:"cardUse",from:c,card:a}),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.cardDraw=function(a,b){if(!(0>a||a>=MOEBATTLE.players.length)){var c=MOEBATTLEUI.showDetail(b,"card");if(void 0===c)return void console.warn("fail to cardDraw ui");++MOEBATTLEUI.AnimaCount,c.css({top:"48%",left:"95%",height:"4%",width:"1%"}).animate({top:"10%",left:"50%",height:"80%",width:"40%"},"fast",function(){var c=this;setTimeout(function(){var d="75%",e="45%";0==a?(d="75%",e="45%"):(d="5%",e="45%"),$(c).find(".card-detail").hide(),$(c).animate({top:d,left:e,height:"150px",width:"100px"},"slow",function(){var d=MOEBATTLEUI.createCard(b);0==a?($("#"+MOEPROJ.config.canvas+" #myhand").append(d.detach()),d.addClass("inhand myhand")):($("#"+MOEPROJ.config.canvas+" #yourhand").append(d.detach()),d.addClass("inhand yourhand")),d.css({top:"0px",left:"0px"}),$(c).fadeOut("slow",function(){$(this).find(".card-detail").css({visibility:"inherit"}).show(),MOEBATTLEUI.detail_lock=!1}),d.hide().css({visibility:"inherit"}).fadeIn("slow",function(){--MOEBATTLEUI.AnimaCount})})},200)})}},MOEBATTLEUI.cardUseWithoutTarget=function(a){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #card-"+a).animate({top:"-=100px",left:"-=100px",height:"+=200px",width:"+=200px",opacity:0},"slow",function(){$(this).remove(),MOEBATTLEUI.skillAnimate(a,""),--MOEBATTLEUI.AnimaCount})},MOEBATTLEUI.cardAddToArea=function(a,b){++MOEBATTLEUI.AnimaCount;var c=$("#"+MOEPROJ.config.canvas+" #card-"+a+" img").height(),d=$("#"+MOEPROJ.config.canvas+" #card-"+a+" img").width();c>60&&(d*=60/c,c=60),d>60&&(c*=60/d,d=60),10>c&&(c=10),10>d&&(d=10),MOEBATTLEUI.moveToAreaAnima(a,b,c,d),--MOEBATTLEUI.AnimaCount},MOEBATTLEUI.moveToAreaAnima=function(a,b,c,d){++MOEBATTLEUI.AnimaCount,$("#"+MOEPROJ.config.canvas+" #card-"+a).animate({top:"50%",left:"45%",height:c+"px",width:d+"px"},"slow",function(){$(this).remove(),MOEBATTLEUI.createIcon(b,a,c,d),MOEBATTLEUI.skillAnimate(a,"skill0"),--MOEBATTLEUI.AnimaCount})},MOEBATTLEUI.selectedIcon=void 0,MOEBATTLEUI.createIcon=function(a,b,c,d){++MOEBATTLEUI.AnimaCount;var e;switch(a){case 1:e=$("#"+MOEPROJ.config.canvas+" #yourarea");break;case 0:default:e=$("#"+MOEPROJ.config.canvas+" #myarea")}e.append(' 		<div id="icon-'+b+'" class="icon myuse" style="height: '+c+"px; width: "+d+'px;"> 			<span></span> 			<img src="" alt="icon" class="" /> 			<div class="cost"></div> 			<div class="def"></div> 			<div class="atk"></div> 			<div class="card-hp"></div> 		</div> 	'),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" img").attr("src",MOEBATTLE.cards[b].photo).error(function(){$(this).attr("src","resources/nophoto.jpg")}),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.atk").html(MOEBATTLE.cards[b].atk||0),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.def").html(MOEBATTLE.cards[b].def||0),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.card-hp").html(MOEBATTLE.cards[b].hp||0),$("#"+MOEPROJ.config.canvas+" #icon-"+b+" div.cost").html(MOEBATTLE.cards[b].cost||0);var f=$("#"+MOEPROJ.config.canvas+" #icon-"+b);return f.hover(function(){MOEBATTLEUI.selectedIcon=b,$(this).css("z-index",1);var a=MOEBATTLEUI.showDetail(b,"icon");return void 0===a?void console.warn("fail to drawCardAnima"):void 0},function(){MOEBATTLEUI.selectedIcon=void 0,$(this).css("z-index",0),MOEBATTLEUI.hideDetail()}),f.on("click",function(){void 0!==MOEBATTLEUI.selectedIcon&&MOEBATTLEUI.arrowFollow(b,function(a,b){if(void 0!==a&&void 0!==b){var c=$("#"+MOEPROJ.config.canvas+" #icon-"+a),d=$("#"+MOEPROJ.config.canvas+" #icon-"+b);if(0!=c.length&&0!=d.length){var e=c.position(),f=c.parent().offset(),g=d.position(),h=d.parent().offset();c.animate({top:g.top+h.top-f.top,left:g.left+h.left-f.left},"fast",function(){c.animate({top:e.top,left:e.left},"fast",function(){})})}}})}),$("#"+MOEPROJ.config.canvas+" #icon-"+b).hide().css({visibility:"inherit"}).fadeIn("fast",function(){--MOEBATTLEUI.AnimaCount}),$("#"+MOEPROJ.config.canvas+" #icon-"+b)},MOEBATTLEUI.skillAnimate=function(a,b){if(a in MOEBATTLE.cards&&void 0!==MOEBATTLE.cards[a].anime&&void 0!==MOEBATTLE.cards[a].anime[b]){++MOEBATTLEUI.AnimaCount;var c=MOEBATTLE.cards[a].anime[b],d=Math.floor(Math.random()*c.length);$("#"+MOEPROJ.config.canvas+" #anime img").attr("src",c[d]),$("#"+MOEPROJ.config.canvas+" #anime").addClass("active").fadeIn("fast").show(),setTimeout(function(){$("#"+MOEPROJ.config.canvas+" #anime").fadeOut("slow",function(){$(this).removeClass("active"),$("#"+MOEPROJ.config.canvas+" #anime img").attr("src",""),--MOEBATTLEUI.AnimaCount})},30)}},MOEBATTLEUI.selectedStatus=void 0,MOEBATTLEUI.createStatus=function(a,b){++MOEBATTLEUI.AnimaCount;var c;switch(a){case 1:c=$("#"+MOEPROJ.config.canvas+" #yourstatusarea");break;case 0:default:c=$("#"+MOEPROJ.config.canvas+" #mystatusarea")}c.append(' 		<div id="status-'+b+'" class="status myuse"> 			<img src="" alt="status" class="" /> 		</div> 	'),$("#"+MOEPROJ.config.canvas+" #status-"+b+" img").attr("src",MOEBATTLE.battle.status[b].photo).error(function(){$(this).attr("src","resources/nophoto.jpg")});var d=$("#"+MOEPROJ.config.canvas+" #status-"+b);return d.hover(function(){MOEBATTLEUI.selectedStatus=b,$(this).css("z-index",1);var a=MOEBATTLEUI.showDetail(b,"status");return void 0===a?void console.warn("fail to drawCardAnima"):void 0},function(){MOEBATTLEUI.selectedStatus=void 0,$(this).css("z-index",0),MOEBATTLEUI.hideDetail()}),$("#"+MOEPROJ.config.canvas+" #status-"+b).hide().css({visibility:"inherit"}).fadeIn("fast",function(){--MOEBATTLEUI.AnimaCount}),$("#"+MOEPROJ.config.canvas+" #status-"+b)};